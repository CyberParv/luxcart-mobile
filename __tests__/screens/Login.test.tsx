import React from 'react'; import { fireEvent, render } from '@testing-library/react-native'; import Login from '@/app/(auth)/login'; import { renderWithProviders } from '../utils/test-utils'; describe('Login Screen', () => { it('renders email and password inputs', () => { const { getByPlaceholderText } = renderWithProviders(<Login />); expect(getByPlaceholderText('Email')).toBeTruthy(); expect(getByPlaceholderText('Password')).toBeTruthy(); }); it('shows validation errors for empty fields on submit', () => { const { getByText, getByRole } = renderWithProviders(<Login />); fireEvent.press(getByRole('button')); expect(getByText('Email is required')).toBeTruthy(); expect(getByText('Password is required')).toBeTruthy(); }); it('shows validation error for invalid email format', () => { const { getByText, getByPlaceholderText, getByRole } = renderWithProviders(<Login />); fireEvent.changeText(getByPlaceholderText('Email'), 'invalid-email'); fireEvent.press(getByRole('button')); expect(getByText('Invalid email format')).toBeTruthy(); }); it('calls login() with credentials on valid submit', () => { const login = jest.fn(); const { getByPlaceholderText, getByRole } = renderWithProviders(<Login login={login} />); fireEvent.changeText(getByPlaceholderText('Email'), 'user@example.com'); fireEvent.changeText(getByPlaceholderText('Password'), 'password123'); fireEvent.press(getByRole('button')); expect(login).toHaveBeenCalledWith({ email: 'user@example.com', password: 'password123' }); }); it('shows loading state during login', () => { const { getByRole, getByTestId } = renderWithProviders(<Login loading />); expect(getByTestId('spinner')).toBeTruthy(); }); it('shows error message when login fails (401)', async () => { const { getByText, getByRole } = renderWithProviders(<Login />); fireEvent.press(getByRole('button')); await expect(getByText('Invalid credentials')).toBeTruthy(); }); it('shows error message when network is down', async () => { const { getByText, getByRole } = renderWithProviders(<Login />); fireEvent.press(getByRole('button')); await expect(getByText('Network error')).toBeTruthy(); }); it('navigates to main app on successful login', () => { const { getByRole } = renderWithProviders(<Login />); fireEvent.press(getByRole('button')); expect(useRouter().push).toHaveBeenCalledWith('/main'); }); it('navigates to signup screen when link tapped', () => { const { getByText } = renderWithProviders(<Login />); fireEvent.press(getByText('Sign up')); expect(useRouter().push).toHaveBeenCalledWith('/signup'); }); });