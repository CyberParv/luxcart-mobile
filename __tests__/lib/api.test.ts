import axios from 'axios'; import { api } from '@/lib/api'; import { mockApi } from '../utils/test-utils'; describe('API', () => { it('adds auth header when token exists', async () => { mockApi({ data: {} }); await api.get('/protected', { headers: { Authorization: 'Bearer valid-token' } }); expect(axios.request).toHaveBeenCalledWith(expect.objectContaining({ headers: expect.objectContaining({ Authorization: 'Bearer valid-token' }) })); }); it('does not add auth header when no token', async () => { mockApi({ data: {} }); await api.get('/public'); expect(axios.request).toHaveBeenCalledWith(expect.not.objectContaining({ headers: expect.objectContaining({ Authorization: expect.any(String) }) })); }); it('handles network timeout', async () => { jest.spyOn(axios, 'request').mockImplementation(() => Promise.reject(new Error('timeout'))); await expect(api.get('/timeout')).rejects.toThrow('timeout'); }); it('retries on network failure', async () => { jest.spyOn(axios, 'request').mockImplementationOnce(() => Promise.reject(new Error('network error'))).mockImplementationOnce(() => Promise.resolve({ data: {} })); await api.get('/retry'); expect(axios.request).toHaveBeenCalledTimes(2); }); });